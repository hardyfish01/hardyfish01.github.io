---
title: 生命周期管理
categories: 
- Tomcat架构解析
---

<img src="https://img-blog.csdnimg.cn/e785b731c60149e3904f86f8c0fb4448.png" style="zoom:25%;" />

上面这张图描述了组件之间的静态关系，如果想让一个系统能够对外提供服务，我们需要创建、组装并启动这些组件；

在服务停止的时候，我们还需要释放资源，销毁这些组件，因此这是一个动态的过程。

> 也就是说，Tomcat需要动态地管理这些组件的生命周期。

**Lifecycle接口**

> 这个接口跟生命周期有关。

Lifecycle接口里应该定义这么几个方法：init、start、stop和destroy，每个具体的组件去实现这些方法。

理所当然，在父组件的init方法里需要创建子组件并调用子组件的init方法。

同样，在父组件的start方法里也需要调用子组件的start方法，因此调用者可以无差别的调用各组件的init方法和start方法，这就是**组合模式**的使用，并且只要调用最顶层组件，也就是Server组件的init和start方法，整个Tomcat就被启动起来了。

**Lifecycle事件**

我们注意到，组件的init和start调用是由它的父组件的状态变化触发的，上层组件的初始化会触发子组件的初始化，上层组件的启动会触发子组件的启动，因此我们把组件的生命周期定义成一个个状态，把状态的转变看作是一个事件。

> 而事件是有监听器的，在监听器里可以实现一些逻辑，并且监听器也可以方便的添加和删除，这就是典型的**观察者模式**。

具体来说就是在Lifecycle接口里加入两个方法：添加监听器和删除监听器。

除此之外，我们还需要定义一个Enum来表示组件有哪些状态，以及处在什么状态会触发什么样的事件。

