---
title: 组合和继承
categories: 
- 代码整洁之道
---

尽管我们鼓励多用组合少用继承，但组合也并不是完美的，继承也并非一无是处。

* 如果类之间的继承结构稳定（不会轻易改变），继承层次比较浅（比如，最多有两层继承关系），继承关系不复杂，我们就可以大胆地使用继承。

* 系统越不稳定，继承层次很深，继承关系复杂，我们就尽量使用组合来替代继承。

除此之外，还有一些设计模式会固定使用继承或者组合。

比如，装饰者模式、策略模式、组合模式等都使用了组合关系，而模板模式使用了继承关系。

* 利用继承特性，我们把相同的属性和方法，抽取出来，定义到父类中。

* 子类复用父类中的属性和方法，达到代码复用的目的。

但是，有的时候，从业务含义上，A类和B类并不一定具有继承关系。

* 比如，Crawler类和PageAnalyzer类，它们都用到了URL拼接和分割的功能，但并不具有继承关系（既不是父子关系，也不是兄弟关系）。

* 仅仅为了代码复用，生硬地抽象出一个父类出来，会影响到代码的可读性。

**还有一些特殊的场景要求我们必须使用继承。**

如果你不能改变一个函数的入参类型，而入参又非接口，为了支持多态，只能采用继承来实现。

比如下面这样一段代码，其中FeignClient是一个外部类，我们没有权限去修改这部分代码，但是我们希望能重写这个类在运行时执行的encode()函数。这个时候，我们只能采用继承来实现了。

```java
public class FeignClient { // Feign Client框架代码
  //...省略其他代码...
  public void encode(String url) { //... }
}

public void demofunction(FeignClient feignClient) {
  //...
  feignClient.encode(url);
  //...
}

public class CustomizedFeignClient extends FeignClient {
  @Override
  public void encode(String url) { //...重写encode的实现...}
}

// 调用
FeignClient client = new CustomizedFeignClient();
demofunction(client);
```
