---
title: 领域、子域和限界上下文
categories: 
- 实现领域驱动设计
---

书籍：https://book.douban.com/subject/25844633/

<img src="https://img-blog.csdnimg.cn/c0ce4051d65c4864bc6b19b682fdb9fe.png" style="zoom:25%;" />

**领域**

领域既可以表示整个业务系统，也可以表示其中的某个核心域或者支撑域。

* 在DDD中，一个领域被分成若干子域，领域模型在限界上下文中完成开发，在开发一个领域模型时，我们关注的通常只是这个业务系统的某个方面。

* 领域就是用来确定范围的，范围即边界，这也是DDD在设计中不断强调边界的原因。

* 在研究和解决业务问题时，DDD会按照一定的规则将业务领域进行细分，当领域细分到一定的程度后，DDD会将问题范围限定在特定的边界内，在这个边界内建立领域模型，进而用代码实现该领域模型，解决相应的业务问题。

> 简言之，DDD的领域就是这个边界内要解决的业务问题域。

既然领域是用来限定业务边界和范围的，那么就会有大小之分，领域越大，业务范围就越大，反之则相反。

**子域**

子域是领域更细粒度的划分，根据重要性与功能将领域分为大致三类的多个子域，分别是核心子域、支撑子域和通用子域。

* 核心域是业务成功的主要促成因素，主要竞争力，支撑子域是支撑核心域的，而通用子域是业务系统的公用部分。

* 支撑子域在领域中是可以有多个的，核心域应该是只有一个为好，当然，除了核心域外，其他子域也可以没有。

* 核心域是最重要的，开发核心域的解决方案是一种关键性的业务的投入，应该给予核心域的开发最高的优先级和最优秀的开发团队。

如果核心域中的一些功能可以从核心域中分离出来，那我们可以用模块的形式从核心域分离出来，这里说的模块其实就是java中说的包，也可以理解为命名空间，文件夹。

**限界上下文**

我们知道语言都有它的语义环境，同样，通用语言也有它的上下文环境。

* 为了避免同样的概念或语义在不同的上下文环境中产生歧义，DDD在战略设计上提出了限界上下文这个概念，用来确定语义所在的领域边界。

我们可以将限界上下文拆解为两个词：限界和上下文。

> 限界就是领域的边界，而上下文则是语义环境。通过领域的限界上下文，我们就可以在统一的领域边界内用统一的语言进行交流。

综合一下，限界上下文的定义就是：

* 用来封装通用语言和领域对象，提供上下文环境，保证在领域之内的一些术语、业务相关对象等（通用语言）有一个确切的含义，没有二义性。

* 这个边界定义了模型的适用范围，使团队所有成员能够明确地知道什么应该在模型中实现，什么不应该在模型中实现。

比如说在一个电子商务服务系统的领域中，加入一个库存系统和一个外部的预测系统，那么这个领域就可以拥有对应的三个限界上下文，**一个限界上下文可能被包含在一个子域里，也可能多个子域**，比如电子商务系统就包含了发票子域、订单子域等。

* 如电商领域的商品一样，商品在不同的阶段有不同的术语，在销售阶段是商品，而在运输阶段则变成了货物。同样的一个东西，由于业务领域的不同，赋予了这些术语不同的涵义和职责边界，这个边界就可能会成为未来微服务设计的边界。

**工作中的子域和限界上下文**

看一个简单的例子：一个零售商在线销售产品的例子。

要在这个领域中开展业务，该零售商要展示不同类别的产品，支持下单和付款，还需要安排物流。

在这个领域中，零售商的领域可以分为4个主要的子域：产品目录（Product Catalog）、订单（Order）、发票（Invoicing）和物流（Shiping），下图是一个含有子域和限界上下文的领域，它的上半部分表示了这个的一个电子商务系统。

<img src="https://img-blog.csdnimg.cn/6a7318028c41471f98cb2e71b35934ea.png" style="zoom:25%;" />

这看起来比较简单，一个领域包含四个子域。但是考虑加入一些额外细节，以上这个例子将变得复杂，如果向上述系统加入一个库存（Inventory）系统和外部接入的预测库存系统，如上图下半部分。

目前，该零售商的领域中只包含了三个物理系统，其中两个是内部系统。

这两个系统表示两个限界上下文。这导致了几个子系统承担了太多的业务功能。

**将关注点放在核心域上**

<img src="https://img-blog.csdnimg.cn/7713209f0000435da4688a61cc449cab.png" style="zoom:25%;" />

核心域：它是整个业务领域的一部分，也是业务成功的主要促成因素。

* **支撑子域：**有时，我们会创建或者购买某个限界上下文来支撑我们的业务。如果这样的上下文对应着业务的某些重要方面，但却是不核心，那么它便是一个支撑子域。创建支撑子域的原因在于它们专注于业务的某个方面。

* **通用子域：**如果一个系统被用于整个业务系统，那么这个子域便是通用子域。

并不能说支撑子域和通用子域是不重要的，它们是重要的，只是我们对他们的要求并没有像核心域那么高。

<img src="https://img-blog.csdnimg.cn/fa3f21370a7d4637853cb47b65906979.png" style="zoom:25%;" />

* 通用域和支撑域如果对应到企业系统，举例来说的话，通用域则是你需要用到的通用系统，比如认证、权限等等，这类应用很容易买到，没有企业特点限制，不需要做太多的定制化。

* 而支撑域则具有企业特性，但不具有通用性，例如数据代码类的数据字典等系统。

**交易系统**

<img src="https://img-blog.csdnimg.cn/3a841a991792456abbab9a52fed524f6.png" style="zoom:25%;" />

**子域划分**

**从交易系统来看：**

- 核心域：订单域、支付域、营销域
- 支撑域：仓储配送域、售后域、结算域
- 通用域：用户域、**商品域**、商户域

**理解限界上下文**

让我们来看下一个账户（Account）模型在银行上下文（Blanking Context）和文学上下文（Literary Context）中的不同，如下表：

<img src="https://img-blog.csdnimg.cn/5deff00b3d534e10ac49abe9414a16cf.png" style="zoom:50%;" />

在图中，光凭名字我们根本无法区分两个账户的意思。只有通过它们所在的限界上下文我们才能看出他们之间的区别。

**限界上下文和微服务的关系**

在这里我用一个简化的保险模型来说明下限界上下文和微服务的关系。

<img src="https://img-blog.csdnimg.cn/1a69502ac8ed4aeab42235be607c3d9d.png" style="zoom:25%;" />

首先，领域可以拆分为多个子领域。一个领域相当于一个问题域，领域拆分为子域的过程就是**大问题拆分为小问题**的过程。

* 在这个图里面保险领域被拆分为：投保、支付、保单管理和理赔四个子域。

* 子域还可根据需要进一步拆分为子子域，比如，支付子域可继续拆分为收款和付款子子域。

* 拆到一定程度后，有些子子域的领域边界就可能变成限界上下文的边界了。

* 子域可能会包含多个限界上下文，如理赔子域就包括报案、查勘和定损等多个限界上下文（限界上下文与理赔的子子域领域边界重合）。

* 也有可能子域本身的边界就是限界上下文边界，如投保子域。

每个领域模型都有它对应的限界上下文，团队在限界上下文内用通用语言交流。领域内所有限界上下文的领域模型构成整个领域的领域模型。

> 理论上限界上下文就是微服务的边界。我们将限界上下文内的领域模型映射到微服务，就完成了从问题域到软件的解决方案。

可以说，限界上下文是微服务设计和拆分的主要依据。在领域模型中，如果不考虑技术异构、团队沟通等其它外部因素，一个限界上下文理论上就可以设计为一个微服务。

> 这里还是要提示一下：除了理论，微服务的拆分还是有很多限制因素的，在设计中不宜过度拆分。