---
title: 基本概念
categories: 
- 服务器
- Docker
---

Docker 要做的就是把各种软件打包成一个集装箱（镜像），然后分发，且在运行的时候可以相互隔离。

Docker 是利用 Linux 的 Namespace 、Cgroups 和联合文件系统三大机制来保证实现的

* 使用 Namespace 做主机名、网络、PID 等资源的隔离

* 使用 Cgroups 对进程或者进程组做资源（例如：CPU、内存等）的限制

* 联合文件系统用于镜像构建和容器运行环境。

**Namespace**

Namespace 是 Linux 内核的一项功能，该功能对内核资源进行隔离，使得容器中的进程都可以在单独的命名空间中运行，并且只可以访问当前容器命名空间的资源。

* Namespace 可以隔离进程 ID、主机名、用户 ID、文件名、网络访问和进程间通信等相关资源。

**Cgroups**

Cgroups 是一种 Linux 内核功能，可以限制和隔离进程的资源使用情况（CPU、内存、磁盘 I/O、网络等）。

* 在容器的实现中，Cgroups 通常用来限制容器的 CPU 和内存等资源的使用。

**联合文件系统**

联合文件系统，又叫 UnionFS，是一种通过创建文件层进程操作的文件系统，因此，联合文件系统非常轻快。

* Docker 使用联合文件系统为容器提供构建层，使得容器可以实现写时复制以及镜像的分层构建和存储。

常用的联合文件系统有 AUFS、Overlay 和 Devicemapper 等。

**镜像**

通俗地讲，它是一个只读的文件和文件夹组合。

它包含了容器运行时所需要的所有基础文件和配置信息，是容器启动的基础。

* 你想启动一个容器，那首先必须要有一个镜像。镜像是 Docker 容器启动的先决条件。

如果你想要使用一个镜像，你可以用这两种方式：

* 自己创建镜像。通常情况下，一个镜像是基于一个基础镜像构建的，你可以在基础镜像上添加一些用户自定义的内容。

* 从功能镜像仓库拉取别人制作好的镜像。一些常用的软件或者系统都会有官方已经制作好的镜像，例如nginx、ubuntu、centos、mysql等，你可以到 Docker Hub 搜索并下载它们，https://hub.docker.com/

**容器**

通俗地讲，容器是镜像的运行实体。

镜像是静态的只读文件，而容器带有运行时需要的可写文件层，并且容器中的进程属于运行状态。

* 即容器运行着真正的应用进程。容器有初建、运行、停止、暂停和删除五种状态。

虽然容器的本质是主机上运行的一个进程，但是容器有自己独立的命名空间隔离和资源限制。

也就是说，在容器内部，无法看到主机上的进程、环境变量、网络等信息，这是容器与直接运行在主机上进程的本质区别。

**仓库**

Docker 的镜像仓库类似于代码仓库，用来存储和分发 Docker 镜像。

* 镜像仓库分为公共镜像仓库和私有镜像仓库。

目前，Docker Hub 是 Docker 官方的公开镜像仓库，它不仅有很多应用或者操作系统的官方镜像，还有很多组织或者个人开发的镜像供我们免费存放、下载、研究和使用。

* 除了公开镜像仓库，你也可以构建自己的私有镜像仓库

<img src="https://img-blog.csdnimg.cn/5ccfa23e89bd46979602fed04d6bff14.png" style="zoom:20%;" />

* 镜像是容器的基石，容器是由镜像创建的。
* 一个镜像可以创建多个容器，容器是镜像运行的实体。
* 仓库就非常好理解了，就是用来存放和分发镜像的。

**Docker Compose**

Docker 三种常用的编排工具：Docker Compose、Docker Swarm 和 Kubernetes。

了解这些编排工具，可以让你在不同的环境中选择最优的编排框架。

**Docker Swarm**

Docker 官方为了解决多容器管理的问题推出了 Docker Swarm ，我们可以用它来管理规模更大的容器集群。

**Kubernetes**

Kubernetes 是舵手的意思，我们把 Docker 比喻成一个个集装箱，而 Kubernetes 正是运输这些集装箱的舵手。

**DevOps**

DevOps 是研发工程师（Development）和运维工程师（Operations）的组合。

DevOps 的整体目标是促进开发和运维人员之间的配合，并且通过自动化的手段缩短软件的整个交付周期，提高软件的可靠性。

Docker 几乎满足了微服务的所有需求，Docker 为 DevOps 提供了很好的基础支撑。

微服务、Docker 与 DevOps 三者之间的关系：

* 云平台作为底层基础，采用 Docker 技术将服务做容器化部署，并且使用资源管理和调度平台（例如 Kubernetes 或 Swarm）来自动化地管理容器。
* DevOps 平台在云基础平台之上，通过流程自动化以及工具自动化的手段，为可持续集成和交付提供能力支持。
* 有了云平台和 DevOps 的支撑，微服务才能够发挥更大的作用，使得我们的业务更加成熟和稳定。

**CI 持续集成（Continuous Integration）**

随着软件功能越来越复杂，一个大型项目要想在规定时间内顺利完成，就需要多位开发人员协同开发。

* 如果我们每个人都负责开发自己的代码，然后集中在某一天将代码合并在一起（称为合并日）。

你会发现，代码可能会有很多冲突和编译问题，而这个处理过程十分烦琐、耗时，并且需要每一位工程师确认代码是否被覆盖，代码是否完整。这种情况显然不是我们想要看到的，这时持续集成（CI）就可以很好地帮助我们解决这个问题。

* CI 持续集成要求开发人员频繁地（甚至是每天）将代码提交到共享分支中。

一旦开发人员的代码被合并，将会自动触发构建流程来构建应用，并通过触发自动化测试（单元测试或者集成测试）来验证这些代码的提交，确保这些更改没有对应用造成影响。

如果发现提交的代码在测试过程中或者构建过程中有问题，则会马上通知研发人员确认，修改代码并重新提交。

**CD 持续交付（Continuous Delivery）**

当我们每次完成代码的测试和构建后，我们需要将编译后的镜像快速发布到测试环境，这时我们的持续交付就登场了。

容器化后的应用交付过程是这样的，我们将测试的环境交由 QA 来维护，当我们确定好本次上线要发布的功能列表时，我们将不同开发人员开发的 feature 分支的代码合并到 release 分支。

然后由 QA 来将构建镜像部署到测试环境，结合自动测试和人工测试、自动检测和人工记录，形成完整的测试报告，并且把测试过程中遇到的问题交由开发人员修改，开发修改无误后再次构建测试环境进行测试。

测试没有问题后，自动交付生产环境的镜像到镜像仓库。

**CD 持续部署（Continuous Deployment**）

经测试无误打包完生产环境的镜像后，我们需要把镜像部署到生产环境，持续部署是最后阶段，它作为持续交付的延伸，可以自动将生产环境的镜像发布到生产环境中。
